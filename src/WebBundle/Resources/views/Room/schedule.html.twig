{% extends 'WebBundle:layouts:main.html.twig' %}

{% block content %}
    <!--  CONTENT -->
    <div class="content container-fluid">
        <div class="row room genesis">
            <img src="{{ asset('img/genesis-img.jpg') }}" alt="Проект: Genesis" class="room-images">

            <div class="room-left-panel">
                <img src="{{ asset('img/genesis-logo.png') }}" alt="Логотип комнаты" class="room-logo">
                <h3 class="room-title">{{ room.title }}</h3>
                <p class="room-complexity">{{ 'Complexity'|trans }} {{ room.difficulty }}</p>
                <p class="room-description">{{ room.description }}</p>
                <p class="team">Number of players {{ room.playersMin }}-{{ room.playersMax }}</p>
                <p class="time-to-play">{{ room.title }} minutes to pass</p>
            </div>

            {#<a href="#" class="team-results">Результаты команд</a>#}

            {#<p class="average-time">Среднее время <span>40</span> мин.</p>#}

            <div class="room-right-panel">
                <p><span class="glyphicon glyphicon-phone" aria-hidden="true"></span> {{ room.phone }}</p>
                <p><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span> {{ room.email }}</p>
                <p><i class="fa fa-map-marker" aria-hidden="true"></i> {{ room.address }}</p>
            </div>
        </div>

        <section class="schedule">
            <h2 class="text-center ">{{ 'Quest schedule'|trans }}</h2>
            <div class="schedule-slider">
                <ul class="slides">
                    <li>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    {% for game in schedule[0]['games']|slice(0, 7) %}
                                        <th class="{% if loop.index == 1 %}th-today{% endif %} {% if game.date|date('l') in ['Saturday', 'Sunday'] %}th-weekend{% endif %}">
                                            {% if loop.index == 1 %}
                                                <small>{{ 'Today'|trans }}</small><br>{% endif %}
                                            <span class="th-date">{{ game.date|date('d') }} {{ game.date|date('F')|trans }}</span><br>
                                            <small>{{ game.date|date('l')|trans }}</small>
                                        </th>
                                    {% endfor %}
                                </tr>
                                </thead>
                                <tbody>
                                {% for row in schedule %}
                                    <tr>
                                        <td class="t-time">{{ row.time }}</td>
                                        {% for game in row.games|slice(0, 7) %}
                                            {% set color = (game.minPrice <= 500) ? 't-danger' : (game.minPrice <= 600) ? 't-warning' : (game.minPrice <= 700) ? 't-info' : (game.minPrice <= 800) ? 't-success' : 't-primary' %}
                                            <td>
                                                <div class="{{ color }}" data-toggle="modal" data-target="#reservation">
                                                    <span class="game-time">{{ row.time }}</span> - {% if game.busy %}busy
                                                    {% else %}<span class="nowrap">
                                                        <span class="game-price">{{ game.minPrice }}</span> {{ room.currency }}{% endif %}
                                                    </span>
                                                </div>
                                            </td>
                                        {% endfor %}
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </li>

                    <li>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th></th>
                                    {% for game in schedule[0]['games']|slice(7, 14) %}
                                        <th class="{% if game.date|date('l') in ['Saturday', 'Sunday'] %}th-weekend{% endif %}">
                                            <br>
                                            <span class="th-date">{{ game.date|date('d F') }}</span><br>
                                            <small>{{ game.date|date('l') }}</small>
                                        </th>
                                    {% endfor %}
                                </tr>
                                </thead>
                                <tbody>
                                {% for row in schedule %}
                                    <tr>
                                        <td class="t-time">{{ row.time }}</td>
                                        {% for game in row.games|slice(7, 14) %}
                                            {% set color = (game.minPrice <= 500) ? 't-danger' : (game.minPrice <= 600) ? 't-warning' : (game.minPrice <= 700) ? 't-info' : (game.minPrice <= 800) ? 't-success' : 't-primary' %}
                                            <td>
                                                <div class="{{ color }}" data-toggle="modal" data-target="#reservation">
                                                    <span class="game-time">{{ row.time }}</span> - {% if game.busy %}busy
                                                    {% else %}<span class="nowrap">
                                                        <span class="game-price">{{ game.minPrice }}</span> грн{% endif %}
                                                    </span>
                                                </div>
                                                {#<br>{% for price in game.prices %}{{ price.players }} / {{ price.price }}<br>{% endfor %}#}
                                            </td>
                                        {% endfor %}
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </li>
                </ul>
            </div>
        </section>

        <div class="container-fluid">
            <div class="row">
                <div id="google-maps"></div>
            </div>
        </div>

        <section class="results">
            <h2 class="text-center">Отзывы игроков</h2>
            <a href="#" class="btn btn-warning show-results">Написать отзыв</a>
        </section>
    </div>
    <!--  CONTENT end -->

    <!-- MODAL #reservation-->
    <form action="/" class="modal fade" id="reservation" tabindex="-1" role="dialog"
          aria-labelledby="gridSystemModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title room-name">Бронирование комнаты</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <p class="room-time"></p>
                            <p class="room-price"></p>
                        </div>
                        <div class="col-md-4">
                            <div>
                                <input type="text" name="userSurname" id="userSurname" required placeholder="Фамилия">
                            </div>
                            <div>
                                <input type="text" name="userName" id="userName" required placeholder="Имя">
                            </div>
                            <div>
                                <input type="email" name="userEmail" id="userEmail" required placeholder="Email">
                            </div>
                            <div>
                                <input type="tel" name="userPhone" id="userPhone" required placeholder="Телефон">
                            </div>
                            <div>
                                <input type="text" name="userPromo" id="userPromo" placeholder="Промо-код">
                            </div>
                        </div>
                        <div class="col-md-4">Способ оплаты</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-warning" id="saveReservation">Забронировать</button>
                </div>
            </div>
        </div>
    </form>
    <!-- MODAL #reservation end -->
    <!--  CONTENT end -->
{% endblock %}

{% block javascripts %}
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMugwAfvvSHxHNaQ3gdmEr0_cgSawCc48&callback=initMap" async defer></script>

    <script>

        var coordinates = '{{ room.coordinates }}'.split(' ');

        function initMap() {
            var myLatLng = {lat: parseFloat(coordinates[0]), lng: parseFloat(coordinates[1])};

            var map = new google.maps.Map(document.getElementById('google-maps'), {
                scrollwheel: false,
                zoom: 14,
                center: myLatLng
            });

            var marker = new google.maps.Marker({
                position: myLatLng,
                map: map,
                icon: '/img/panic-marker.png'
            });
        }
    </script>

    {{ parent() }}
{% endblock %}